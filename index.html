<!DOCTYPE html><html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Monitoring Stok Gudang</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; background: #f8fafc; }
    .fade-in { animation: fadeIn 0.4s ease-in-out; }
    @keyframes fadeIn { from {opacity: 0;} to {opacity: 1;} }
    .btn { @apply px-3 py-2 rounded-md shadow text-sm flex items-center gap-2 transition hover:opacity-80; }
  </style>
</head>
<body class="min-h-screen flex flex-col">
  <!-- Header -->
  <header class="bg-gradient-to-r from-blue-600 to-blue-800 text-white p-4 md:p-6 shadow-md">
    <div class="max-w-6xl mx-auto flex flex-col md:flex-row md:items-center md:justify-between">
      <div class="flex items-center gap-3">
        <div class="bg-white/20 p-2 rounded-lg">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4" />
          </svg>
        </div>
        <div>
          <h1 class="text-xl md:text-2xl font-bold">Monitoring Stok Gudang</h1>
          <p class="text-blue-100 text-sm">Terhubung otomatis ke Google Sheets</p>
        </div>
      </div>
      <div class="flex flex-wrap items-center gap-2 mt-4 md:mt-0">
        <button id="refreshBtn" class="btn bg-white text-blue-700">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
          </svg>
          Refresh
        </button>
        <button id="downloadPDF" class="btn bg-red-600 text-white hover:bg-red-700">
          <!-- Icon PDF lebih bagus -->
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="currentColor">
            <path d="M6 2a2 2 0 00-2 2v16c0 1.1.9 2 2 2h12a2 2 0 002-2V8l-6-6H6zm7 1.5L18.5 9H13a.5.5 0 01-.5-.5V3.5zM8 13h1.5c.8 0 1.5.7 1.5 1.5S10.3 16 9.5 16H8v2H7v-6h2zm0 1v1h1.5c.3 0 .5-.2.5-.5s-.2-.5-.5-.5H8zm4-.5c0-.8.7-1.5 1.5-1.5H15v1h-1.5c-.3 0-.5.2-.5.5v3c0 .3.2.5.5.5H15v1h-1.5c-.8 0-1.5-.7-1.5-1.5v-3zm4.5-1.5c.8 0 1.5.7 1.5 1.5V14c0 .8-.7 1.5-1.5 1.5H16v2h-1v-6h1.5zM17 13v1h.5c.3 0 .5-.2.5-.5s-.2-.5-.5-.5H17z" />
          </svg>
          Unduh PDF
        </button>
        <span class="hidden md:block text-sm text-blue-100">Terakhir update: <span id="updateTime">-</span></span>
      </div>
    </div>
  </header>  <!-- Dashboard Cards -->  <section class="max-w-6xl mx-auto p-4 grid grid-cols-1 md:grid-cols-3 gap-4">
    <div class="bg-white p-4 rounded-xl shadow hover:shadow-md transition fade-in">
      <p class="text-gray-500 text-sm">Total Produk</p>
      <h2 id="totalProducts" class="text-2xl font-bold">-</h2>
    </div>
    <div class="bg-white p-4 rounded-xl shadow hover:shadow-md transition fade-in">
      <p class="text-gray-500 text-sm">Total Stok</p>
      <h2 id="totalStock" class="text-2xl font-bold">-</h2>
    </div>
    <div class="bg-white p-4 rounded-xl shadow hover:shadow-md transition fade-in">
      <p class="text-gray-500 text-sm">Lokasi Gudang</p>
      <h2 id="totalLocations" class="text-2xl font-bold">-</h2>
    </div>
  </section>  <!-- Filter & Search -->  <section class="max-w-6xl mx-auto p-4 flex flex-col md:flex-row gap-3 md:items-center md:justify-between">
    <div class="relative flex-1">
      <svg class="absolute left-3 top-2.5 h-4 w-4 text-gray-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
      </svg>
      <input id="search" placeholder="Cari produk, ID, atau lokasi..." class="pl-9 pr-4 py-2 w-full rounded-lg border border-gray-300 focus:ring focus:ring-blue-200" />
    </div>
    <div class="flex gap-2">
      <select id="locationFilter" class="border rounded-lg px-3 py-2 text-sm">
        <option value="">Semua Lokasi</option>
      </select>
    </div>
  </section>  <!-- Table -->  <section class="max-w-6xl mx-auto p-4">
    <div class="overflow-x-auto rounded-lg border">
      <table id="stockTable" class="w-full text-sm">
        <thead class="bg-gray-50">
          <tr>
            <th class="p-3 text-left">ID</th>
            <th class="p-3 text-left">Produk</th>
            <th class="p-3 text-left">Palet</th>
            <th class="p-3 text-left">Lokasi</th>
            <th class="p-3 text-left">Stok</th>
          </tr>
        </thead>
        <tbody id="tableBody" class="divide-y">
          <tr>
            <td colspan="5" class="p-6 text-center text-gray-500">Memuat data...</td>
          </tr>
        </tbody>
      </table>
    </div>
    <div class="flex justify-between text-sm text-gray-500 mt-3">
      <div>Menampilkan <span id="showing">0</span> dari <span id="totalItems">0</span></div>
      <div class="flex gap-2">
        <button id="prevPage" class="px-3 py-1 border rounded disabled:opacity-40">Prev</button>
        <button id="nextPage" class="px-3 py-1 border rounded disabled:opacity-40">Next</button>
      </div>
    </div>
  </section>  <script>
    const SHEET_ID = "1kWuc2yMEAeeHQkC5sVvGdNEwH8YLpif2aIQL8qzF3ds";
    const SHEET_NAME = "Sheet1";
    const API_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=${SHEET_NAME}`;
    let allData = [], filteredData = [], currentPage = 1, perPage = 10;

    function loadData(){
      fetch(API_URL).then(r=>r.text()).then(txt=>{
        const json = JSON.parse(txt.substr(47).slice(0,-2));
        const rows = json.table.rows;

        const lastUpdateCell = rows[0]?.c[6]?.v || "-";
        document.getElementById('updateTime').textContent = lastUpdateCell;

        allData = rows.slice(1).map(r=>({
          id: r.c[0]?.v||'',
          nama: r.c[1]?.v||'',
          palet: r.c[2]?.v||'',
          lokasi: r.c[3]?.v||'',
          stok: parseInt(r.c[4]?.v||0)
        }));

        updateDashboard();
        applyFilters();
      }).catch(()=>{
        document.getElementById('tableBody').innerHTML='<tr><td colspan="5" class="p-6 text-center text-red-500">Gagal memuat data, periksa koneksi atau izin Google Sheet</td></tr>';
      });
    }

    function updateDashboard(){
      document.getElementById('totalProducts').textContent = allData.length;
      document.getElementById('totalStock').textContent = allData.reduce((s,d)=>s+d.stok,0);
      document.getElementById('totalLocations').textContent = new Set(allData.map(d=>d.lokasi)).size;
      let locSel = document.getElementById('locationFilter');
      locSel.innerHTML='<option value="">Semua Lokasi</option>';
      Array.from(new Set(allData.map(d=>d.lokasi))).sort().forEach(l=>{
        locSel.innerHTML+=`<option>${l}</option>`;
      });
    }

    function applyFilters(){
      const q=document.getElementById('search').value.toLowerCase();
      const loc=document.getElementById('locationFilter').value;
      filteredData = allData.filter(d=>{
        const matchQ = d.id.toLowerCase().includes(q)||d.nama.toLowerCase().includes(q)||d.lokasi.toLowerCase().includes(q);
        const matchLoc = !loc || d.lokasi===loc;
        return matchQ && matchLoc;
      });
      currentPage=1;
      renderTable();
    }

    function renderTable(){
      let body=document.getElementById('tableBody');
      if(filteredData.length===0){body.innerHTML='<tr><td colspan=5 class="p-6 text-center text-gray-400">Tidak ada data</td></tr>';return;}
      let start=(currentPage-1)*perPage,end=start+perPage;
      let pageData=filteredData.slice(start,end);
      body.innerHTML='';
      pageData.forEach(d=>{
        body.innerHTML+=`<tr class="hover:bg-gray-50 fade-in">
          <td class="p-3">${d.id}</td>
          <td class="p-3">${d.nama}</td>
          <td class="p-3">${d.palet}</td>
          <td class="p-3">${d.lokasi}</td>
          <td class="p-3">${d.stok}</td>
        </tr>`;
      });
      document.getElementById('showing').textContent=pageData.length;
      document.getElementById('totalItems').textContent=filteredData.length;
      document.getElementById('prevPage').disabled=currentPage===1;
      document.getElementById('nextPage').disabled=end>=filteredData.length;
    }

    function downloadPDF(){
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF({orientation:'landscape'});
      const title = 'Laporan Stok Gudang';
      const lastUpdate = document.getElementById('updateTime').textContent;

      doc.setFontSize(16);
      doc.text(title, 14, 15);
      doc.setFontSize(10);
      doc.text(`Terakhir Update: ${lastUpdate}`, 14, 22);

      let rows = [['ID','Produk','Palet','Lokasi','Stok']];
      filteredData.forEach(d=>{
        rows.push([d.id, d.nama, d.palet, d.lokasi, d.stok.toString()]);
      });
      let y = 30;
      rows.forEach(r=>{
        doc.text(r.join(' | '),14,y);
        y+=7;
        if(y>190){doc.addPage();y=20;}
      });
      doc.save('Laporan_Stok_Gudang.pdf');
    }

    document.addEventListener('DOMContentLoaded',()=>{
      loadData();
      document.getElementById('refreshBtn').onclick=loadData;
      document.getElementById('search').oninput=applyFilters;
      document.getElementById('locationFilter').onchange=applyFilters;
      document.getElementById('prevPage').onclick=()=>{if(currentPage>1){currentPage--;renderTable();}};
      document.getElementById('nextPage').onclick=()=>{if(currentPage*perPage<filteredData.length){currentPage++;renderTable();}};
      document.getElementById('downloadPDF').onclick=downloadPDF;
    });
  </script></body>
</html>